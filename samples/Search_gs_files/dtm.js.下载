var constants = {
    SMART_PHONE: "Smartphone",
    IPAD_TABLET: "iPad/Tablet",
    DESKTOP: "Desktop",
    LARGE_SCREEN: "Large Screen",
    VISITOR_SOURCE: "visitorSource",
    UTM_MEDIUM: "utm_medium",
    UTM_SOURCE: "utm_source",
    CITATION_CONTEXT_KEY: "citationContextKey",
    RESEARCH_USER_COOKIE_NAME: "RESEARCH_USER=",
    RESEARCH_USER_GUID_PATTERN: "^[0-9a-f]{32}$",
};

function extractUrlParameters(url) {
    const index = url.indexOf("?");
    return index >= 0 ? url.substring(index + 1) : null;
}

function getUrlKeyValuePair(url, parameterName) {
    const parameters = extractUrlParameters(url);
    if (!parameters) return undefined;
    const paramsArray = parameters.split("&");
    return paramsArray.find(function (param) {
        return param.startsWith(parameterName);
    });
}

function getUrlParam(url, parameterName) {
    const keyValuePair = getUrlKeyValuePair(url, parameterName);
    return keyValuePair ? keyValuePair.split("=")[1] : null;
}

function getDeviceType() {
    console.log("Get deviceType");
    if (document.documentElement.clientWidth < 768) {
        return constants.SMART_PHONE;
    }

    if (document.documentElement.clientWidth >= 768 && document.documentElement.clientWidth < 992) {
        return constants.IPAD_TABLET;
    }
    if (document.documentElement.clientWidth >= 992 && document.documentElement.clientWidth < 1190) {
        return constants.DESKTOP;
    }

    if (document.documentElement.clientWidth >= 1190) {
        return constants.LARGE_SCREEN;
    }
}

function getVisitorSource() {
    var query = window.location.search.substring(1);
    if (query != undefined && query != "") {
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] != "" && pair[0] === constants.VISITOR_SOURCE) {
                return pair[1];
            }
        }
    } else {
        if (document.referrer != undefined && document.referrer != "") {
            return document.referrer;
        }
    }
}

function deleteUrlParameter(url, parameterName) {
    const keyValuePair = getUrlKeyValuePair(url, parameterName);
    if (keyValuePair) {
        const indexOfParamAfter = url.indexOf(keyValuePair + "&");
        const urlWithParamRemoved =
            indexOfParamAfter > 0 ? url.replace(keyValuePair + "&", "") : url.replace(keyValuePair, "");
        const urlWithNoTrailingAmpersand = urlWithParamRemoved.endsWith("&")
            ? urlWithParamRemoved.slice(0, urlWithParamRemoved.length - 1)
            : urlWithParamRemoved;
        return urlWithNoTrailingAmpersand.endsWith("?")
            ? urlWithNoTrailingAmpersand.slice(0, urlWithNoTrailingAmpersand.length - 1)
            : urlWithNoTrailingAmpersand;
    }
    return url;
}

function getGirDocumentGuid() {
    return window.location.pathname.split("/").slice(-1)[0].replace(".html", "");
}

window.getUrlParam = getUrlParam;
window.getDeviceType = getDeviceType;
window.getVisitorSource = getVisitorSource;
window.getGirDocumentGuid = getGirDocumentGuid;
window.deleteUrlParameter = deleteUrlParameter;
