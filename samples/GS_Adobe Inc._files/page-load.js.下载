const getUrlParameter = (url, parameterName) => new URLSearchParams(new URL(url).search).get(parameterName);

const initiatePageLoadWorkflow = async () => {
    const { location, frames, document, performance } = window;
    const { origin, referrer } = frames?.top?.document || {};
    const { hostname, pathname, href } = location || {};
    const eventData = {
        Navigation: { Origin: origin, Referrer: referrer },
        Page: {
            Domain: hostname,
            Path: pathname,
            Name: pathname?.split("/")?.pop()?.split("?.")[0],
            Title: document?.title,
        },
        Visit: {
            TimestampMs: performance?.timeOrigin,
            UTMSource: getUrlParameter(href, "utm_source"),
            UTMMedium: getUrlParameter(href, "utm_medium"),
        },
        Trace: { PageLoadId: await createPageLoadId() },
    };
    sendEventToPanama(eventData, "PortalPageLoad");
};

initiatePageLoadWorkflow();
