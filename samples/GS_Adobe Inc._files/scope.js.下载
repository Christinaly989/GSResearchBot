const initiateScopeWorkflow = () => {
    const panamaScope = getPanamaScope();
    if (panamaScope?.isNewScope) {
        sendEventToPanama(buildPanamaScopeStartEvent(), "PortalScopeStart");
        document.cookie = `panama_scope_started=${panamaScope.scopeId}; path=/`;
    }
};

const buildPanamaScopeStartEvent = () => ({
    Metadata: {
        language: navigator.language,
        localTimeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        cookiesAllowed: navigator.cookieEnabled,
    },
    Navigation: {
        title: document.title,
        url: location.href,
        referrer: document.referrer,
        origin: location.origin,
        domain: location.hostname,
        path: location.pathname,
        hash: location.hash,
    },
    Device: {
        userAgent: navigator.userAgent,
        appVersion: navigator.appVersion,
        platform: navigator.platform,
        memory: navigator.deviceMemory,
        screenWidth: screen.width,
        screenHeight: screen.height,
        screenOrientationType: screen.orientation?.type,
        isTouchScreen: navigator.maxTouchPoints > 0,
        isAutomationControlled: navigator.webdriver,
    },
    Network: {
        effectiveBandwidthMbps: navigator.connection?.downlink,
        effectiveConnectionType: navigator.connection?.effectiveType,
    },
});

initiateScopeWorkflow();
